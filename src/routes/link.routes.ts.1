// src/routes/link.routes.ts
import { Router, type RequestHandler } from 'express';
import * as linkController from '../controllers/link.controller';
import { authenticate } from '../middleware/auth';

const router = Router();

// Helper to normalize async controllers to RequestHandler
const wrap = (fn: any): RequestHandler => (req, res, next) =>
  Promise.resolve(fn(req, res, next)).catch(next);

// All link routes require auth
router.use(authenticate);

// Create a short link
router.post('/', wrap(linkController.createLink));

// List the authenticated user's links
router.get('/', wrap(linkController.getUserLinks));

// Get details for a link by shortCode (owned by the user)
router.get('/:shortCode', wrap(linkController.getLinkDetails));

// Update a link by shortCode
router.put('/:shortCode', wrap(linkController.updateLink));

// Delete a link by shortCode
router.delete('/:shortCode', wrap(linkController.deleteLink));

export default router;

